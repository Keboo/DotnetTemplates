@using ReactApp.Services
@inject ThemeService ThemeService
@implements IDisposable

<CascadingValue Value="ThemeService">
    @if (ThemeService.IsDarkMode.HasValue)
    {
        <MudThemeProvider @bind-IsDarkMode="@_isDarkMode" />
    }
    else
    {
        <MudThemeProvider />
    }
    <MudPopoverProvider />
    <MudDialogProvider />
    <MudSnackbarProvider />
    @ChildContent
</CascadingValue>

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private bool _isDarkMode
    {
        get => ThemeService.IsDarkMode ?? false;
        set => ThemeService.IsDarkMode = value;
    }

    protected override void OnInitialized()
    {
        ThemeService.OnThemeChanged += StateHasChanged;
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= StateHasChanged;
    }
}
