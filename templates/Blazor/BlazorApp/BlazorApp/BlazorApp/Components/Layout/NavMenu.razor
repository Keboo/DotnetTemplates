@implements IDisposable

@inject NavigationManager NavigationManager

<RadzenPanelMenu>
    <RadzenPanelMenuItem Text="Home" Icon="home" Path="" Match="NavLinkMatch.All" />
    <RadzenPanelMenuItem Text="My Rooms" Icon="meeting_room" Path="my-rooms" />
    <RadzenPanelMenuItem Text="Auth Required" Icon="lock" Path="auth" />
    
    <AuthorizeView>
        <Authorized>
            <RadzenPanelMenuItem Text="@($"{context.User.Identity?.Name}")" Icon="person" Path="Account/Manage" />
            <RadzenPanelMenuItem Text="Logout" Icon="logout">
                <Template>
                    <form action="Account/Logout" method="post" style="display: inline; width: 100%;">
                        <AntiforgeryToken />
                        <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                        <button type="submit" style="all: unset; cursor: pointer; width: 100%; display: flex; align-items: center; gap: 0.75rem;">
                            <span class="rz-navigation-item-text">Logout</span>
                        </button>
                    </form>
                </Template>
            </RadzenPanelMenuItem>
        </Authorized>
        <NotAuthorized>
            <RadzenPanelMenuItem Text="Register" Icon="person_add" Path="Account/Register" />
            <RadzenPanelMenuItem Text="Login" Icon="login" Path="Account/Login" />
        </NotAuthorized>
    </AuthorizeView>
</RadzenPanelMenu>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}
